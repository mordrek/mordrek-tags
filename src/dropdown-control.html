<script>
xtag.register('dropdown-control', 
	{
	extends: 'div',
	accessors:
		{
		data : { attribute: {}},
		onchange : { attribute: {}}
		},
	lifecycle: 
		{
		created: function()
			{
				this.innerHTML = "<select>"+this.innerHTML+"</select>";
				this.data = this.data || null;
				this.onchange = this.onchange || null;
				
				if(this.data)
					this.update();
			},
		attributeChanged: function()
			{
				this.update();
			}
		},
	getters:
		{
			'value' : function()
			{
				var l=this.querySelectorAll('select');
				for(var i=0; i < l.length;i++)
					return l[i].value;
			}
		},
	methods:
		{
		doonchange : function(e)
			{
			if(this._change)
				{
				this.value = e.value;
				this._change();
				}
			else alert("!?");
			},
		update: function()
			{
			this._change = this.onchange;
			if(this.data == null)
				return;
			var d = this.data;
			if(typeof d === 'string')
				d = eval(d);

			var s = "<select onchange='this.parentNode.doonchange(this);' onload='onchange();' ";
			s = s+">";
			var index=0; var selectedValue;
			for(var i =0; i < d.length; i++)
				{
					var di = d[i]; 
					s = s+"<option ";
					if(di.selected)
					   {
					   s = s+"selected";
					   index = i;
					   selectedValue = di.value.replace(/'/g, "\'");
					   }
					s = s+" value='"+
						di.value.replace(/'/g, "\'")+"'>"+di.name+"</option>";
				}
			s = s+"</select>";
			this.innerHTML = s;
			this.value = selectedValue;
			var that=this;
			setTimeout(function(){that._change();},0);
//			var l=this.querySelectorAll('select');
//			for(var i=0; i < l.length;i++)
//				{
//					this.value = l[i].value;
//					this._change();
//				}
			
			
			}
		}
	});


</script>