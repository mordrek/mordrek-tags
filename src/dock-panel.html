<script>
xtag.register('dock-panel', 
	{
	extends: 'div',
	accessors:
		{
		dock : { attribute: {}},
		size : { attribute: {}},
		},
	lifecycle: 
		{
		created: function() 
			{
				var s = this.style;
				s.position=s.position||"relative";
				
				var p = this.parentNode;
				if(p!=null&&p.tagName!="DOCK-PANEL") 
				{
					var t=this;
					if(window.attachEvent) {
					window.attachEvent('onresize', function() {
						t.updateRoot();
					});
					}
					else if(window.addEventListener) {
						window.addEventListener('resize', function() {
						t.updateRoot();
					}, true);	
					}	
					this.style.display='block';
					this.style.position='relative';
					this.updateRoot();
				}
				else
				{
					if(p._docks==null)
					   p._docks=[];
					p._docks.push(this);
					this.style.position="absolute";
				}				
			},
		attributeChanged: function()
			{
			}
		},
	methods: 
		{
		updateRoot : function()
			{
				this.updateAll(true);
			},
		updateAll : function(root)
			{
				var t=this;
				if(!root) t.update();
				if(t._docks!=null)
				{
					t._box = []; 
					t._box.x = 0;
					t._box.y = 0;
					t._box.w = t.offsetWidth;
					t._box.h = t.offsetHeight;
					console.log("Base: "+t._box.w+", "+t._box.h);
					for(var i=0; i < t._docks.length;i++)
					{
						t._docks[i].updateAll(false);
					}
				}
			},
			update : function ()
			{
				var p = this.parentNode;
				var box = p._box; 
				var bx = box.x;
				var by = box.y;
				var bw = box.w;
				var bh = box.h; 
				var x=bx;
				var y=by;
				var w=bw;
				var h=bh;
				var sz = this.size||"0";
				var percent = ( sz.indexOf("%")>0);
				var sz = parseInt(sz); 
				switch(this.dock)
				{
					case 'top':
						if(percent)
							sz = sz * h / 100;
						bh -= sz;
						by += sz; 
						h = sz;
						break;
					case 'bottom':
						if(percent)
							sz = sz * h / 100;
						y = y + bh-sz;
						h = sz;
						bh -= sz;
						break;
					case 'left':
						if(percent)
							sz = sz * w / 100;
						bx += sz; 
						w = sz;
						bw -= sz;
						break;
					case 'right':
						if(percent)
							sz = sz * w / 100;
						x = x + bw-sz;
						w = sz;
						bw -= sz;
						break;
					case 'fill':
						break;
				}
				
				this.style.left=x+"px";
				this.style.top=y+"px";
				this.style.width=w+"px";
				this.style.height=h+"px";
				
				p._box = {x:bx,y:by,w:bw,h:bh};
			},			
		}
	});

		
	</script>